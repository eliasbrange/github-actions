name: DevStageProdPipeline

on:
  push:
  release:
    types: [published]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build
        run: echo Building...
        
  unittest:
    runs-on: ubuntu-latest
    needs: [build]
    steps:
      - uses: actions/checkout@v2
      - name: Test
        run: echo Unit tests...
        
  lint:
    runs-on: ubuntu-latest
    needs: [build]
    steps:
      - uses: actions/checkout@v2
      - name: Test
        run: echo Linting...
        
  deploy-dev:
    runs-on: ubuntu-latest
    needs: [unittest, build]
    environment: development
    steps:
      - uses: actions/checkout@v2
      - name: Deploy
        run: echo Deploying to dev...
        
  test-dev:
    runs-on: ubuntu-latest
    needs: [deploy-dev]
    steps:
      - uses: actions/checkout@v2
      - name: Test
        run: echo Testing dev...
        
  deploy-stage:
    runs-on: ubuntu-latest
    if: ${{ github.event_name == 'release' && github.event.action == 'published' }}
    needs: [unittest, build]
    environment: stage
    steps:
      - uses: actions/checkout@v2
      - name: Deploy
        run: echo Deploying to stage...
        
  test-stage:
    runs-on: ubuntu-latest
    needs: [deploy-stage]
    steps:
      - uses: actions/checkout@v2
      - name: Test
        run: echo Testing stage...
        
  deploy-prod:
    runs-on: ubuntu-latest
    if: ${{ github.event_name == 'release' && github.event.action == 'published' }}
    needs: [test-stage]
    environment: prod
    steps:
      - uses: actions/checkout@v2
      - name: Deploy
        run: echo Deploying to prod
        
  test-prod:
    runs-on: ubuntu-latest
    needs: [deploy-prod]
    steps:
      - uses: actions/checkout@v2
      - name: Test
        run: echo Testing prod
